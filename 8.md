Absolutely ğŸ‘
Hereâ€™s **another Lab 8 example**, different from deploy-only-on-main, that really drills **expressions, conditions, contexts, and step outputs**â€”with a **clear mental model**.

---

# ğŸ§ª Lab 8: Expressions & Conditions (Branch + File-Change Logic)

## ğŸ¯ Scenario (Very Real-World)

You want to:

* Run **heavy tests only on `main`**
* Run **light checks on feature branches**
* **Skip everything** if only docs changed

This is extremely common in real CI pipelines.

---

## ğŸ§  Concepts Youâ€™ll Learn in This Lab

* `if:` conditions
* `github` context
* Step outputs
* Boolean expressions
* `always()` and `success()`

---

## âœ… Complete Working Workflow

```yaml
name: Conditional CI Using Expressions

on:
  push:
    branches:
      - main
      - "feature/*"

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Detect changed files
        id: changes
        run: |
          git fetch origin main
          CHANGED_FILES=$(git diff --name-only origin/main...HEAD)
          echo "changed_files=$CHANGED_FILES" >> $GITHUB_OUTPUT

      - name: Show changed files
        run: echo "Files changed: ${{ steps.changes.outputs.changed_files }}"

      - name: Skip if only docs changed
        if: >
          !contains(steps.changes.outputs.changed_files, 'docs/')
        run: echo "Code changes detected, continuing CI"

      - name: Light checks (feature branches)
        if: github.ref != 'refs/heads/main'
        run: echo "Running fast checks for feature branch"

      - name: Heavy tests (main branch)
        if: github.ref == 'refs/heads/main'
        run: echo "Running full test suite for main branch"

      - name: Always run cleanup
        if: always()
        run: echo "Cleaning up resources"
```

---

## ğŸ” Line-by-Line Explanation (Important Parts)

---

### 1ï¸âƒ£ Detect Changed Files (Step Output)

```yaml
id: changes
echo "changed_files=$CHANGED_FILES" >> $GITHUB_OUTPUT
```

âœ” Creates a **step output**
âœ” Accessible via:

```yaml
steps.changes.outputs.changed_files
```

---

### 2ï¸âƒ£ Expression Functions (`contains`)

```yaml
if: !contains(steps.changes.outputs.changed_files, 'docs/')
```

Meaning:

* If changed files **do NOT include** `docs/`
* Continue CI

This uses **GitHub expression functions**, not shell logic.

---

### 3ï¸âƒ£ Branch-Based Conditions

```yaml
if: github.ref == 'refs/heads/main'
```

âœ” Runs only on main
âœ” Exact ref comparison (important!)

---

### 4ï¸âƒ£ Feature Branch Logic

```yaml
if: github.ref != 'refs/heads/main'
```

âœ” Runs on any non-main branch

---

### 5ï¸âƒ£ `always()` Condition

```yaml
if: always()
```

âœ” Runs even if previous steps fail
âœ” Perfect for cleanup, logs, notifications

---

## ğŸ§ª Test This Lab

| Scenario            | Expected Behavior    |
| ------------------- | -------------------- |
| Change only `docs/` | CI skips heavy logic |
| Feature branch      | Light checks only    |
| Main branch         | Heavy tests run      |
| Fail earlier step   | Cleanup still runs   |

---

## ğŸ§  Key Rules to Remember (Lab 8)

| Rule               | Why                      |
| ------------------ | ------------------------ |
| Use `github.ref`   | Branch-aware logic       |
| Use outputs        | Share data between steps |
| Prefer expressions | Faster & safer           |
| Use `always()`     | Cleanup & notifications  |

---

## âš ï¸ Common Mistakes (Avoid These)

âŒ Using shell variables in `if:`

```yaml
if: $CHANGED_FILES != ''
```

âœ” Correct:

```yaml
if: steps.changes.outputs.changed_files != ''
```

---

## ğŸ”¥ Optional Advanced Challenge

Try this:

1. Fail the heavy test step
2. Add a Slack notification using `if: failure()`
3. Ensure cleanup still runs

---

## ğŸš€ Where This Fits in Real Pipelines

This exact pattern is used in:

* Monorepos
* Microservices CI
* Cost-optimized pipelines
* Enterprise GitHub Actions setups


